# SysKey - Painel de Extra√ß√£o de Chaves de Produto

SysKey √© um aplicativo de desktop desenvolvido em Python com a biblioteca CustomTkinter. Ele utiliza a API Gemini do Google para extrair chaves de produto do Windows a partir de imagens (OCR), oferecendo uma interface gr√°fica para gerenciar, validar e salvar essas chaves em uma planilha Excel.

![Imagem da Interface do SysKey](https://i.imgur.com/gK2R1vG.png)

---

## ‚ú® Funcionalidades

- **Extra√ß√£o por OCR:** Usa a IA Generativa do Google (Gemini) para ler chaves de produto de arquivos de imagem (`.jpg`, `.png`, etc.).
- **Carregamento em Massa:** Processa m√∫ltiplos arquivos de imagem de uma s√≥ vez ao selecionar uma pasta.
- **Painel de Gerenciamento Interativo:**
    - **Edi√ß√£o Manual:** Permite corrigir ou adicionar chaves diretamente na interface.
    - **Reordena√ß√£o:** Altere a ordem das chaves com bot√µes de "Subir" (‚Üë) e "Descer" (‚Üì).
    - **Exclus√£o:** Remova chaves individuais com um clique.
- **Valida√ß√£o em Tempo Real:**
    - Verifica se cada chave segue o formato padr√£o do Windows (`XXXXX-XXXXX-XXXXX-XXXXX-XXXXX`).
    - O status de cada chave (`‚úÖ Padr√£o Correto` ou `‚ö†Ô∏è Verificar Formato`) √© atualizado instantaneamente enquanto voc√™ digita.
- **Relat√≥rio Din√¢mico:** Um painel de relat√≥rio na parte inferior lista todas as chaves com formato inv√°lido, indicando o n√∫mero da linha para f√°cil localiza√ß√£o.
- **Exporta√ß√£o para Excel:**
    - **Substituir:** Cria uma nova planilha Excel com as chaves do painel.
    - **Adicionar:** Adiciona as chaves do painel a uma planilha existente, evitando duplicatas.
    - O arquivo Excel √© salvo sem cabe√ßalho para facilitar a contagem de chaves.
- **Interface Moderna:** Desenvolvida com CustomTkinter para um visual limpo e agrad√°vel.

---

## üöÄ Como Usar o Aplicativo

1.  **Carregar Chaves:**
    - Clique em **"Carregar Arquivo"** para selecionar uma √∫nica imagem.
    - Clique em **"Carregar Pasta"** para processar todas as imagens de uma pasta.
2.  **Gerenciar Chaves no Painel:**
    - As chaves extra√≠das aparecer√£o na lista.
    - **Corrija** qualquer chave diretamente no campo de texto. As letras ser√£o convertidas para mai√∫sculas automaticamente.
    - **Reordene** as chaves usando os bot√µes ‚Üë e ‚Üì.
    - **Exclua** chaves desnecess√°rias clicando em "Excluir".
    - **Adicione** uma nova linha clicando em "Adicionar Chave Manualmente".
3.  **Verificar o Relat√≥rio:**
    - O painel "Relat√≥rio de Valida√ß√£o" na parte inferior informar√° se h√° chaves com formato inv√°lido e em qual linha elas est√£o.
    - O status ao lado de cada chave tamb√©m indica sua validade.
4.  **Salvar em Excel:**
    - Ap√≥s revisar e validar todas as chaves, clique em **"Adicionar ao Excel"** ou **"Substituir a Planilha"**.
    - O arquivo `chaves_extraidas_final.xlsx` ser√° salvo na mesma pasta do aplicativo e aberto automaticamente.

---

## üõ†Ô∏è Configura√ß√£o do Ambiente (Para Desenvolvedores)

Para executar o projeto a partir do c√≥digo-fonte, siga estes passos:

1.  **Clone o Reposit√≥rio:**
    ```bash
    git clone [https://github.com/seu-usuario/seu-repositorio.git](https://github.com/seu-usuario/seu-repositorio.git)
    cd seu-repositorio
    ```

2.  **Crie um Arquivo de Ambiente (`.env`):**
    - Na raiz do projeto, crie um arquivo chamado `.env`.
    - Dentro deste arquivo, adicione sua chave da API Gemini:
      ```
      GEMINI_API_KEY="SUA_CHAVE_API_AQUI"
      ```

3.  **Instale as Depend√™ncias:**
    - √â recomendado usar um ambiente virtual (`venv`).
    - Instale todas as bibliotecas necess√°rias com o pip:
      ```bash
      pip install pandas customtkinter Pillow python-dotenv google-generativeai
      ```

4.  **Execute o Script:**
    ```bash
    python seu_script.py
    ```

---

## üèóÔ∏è Estrutura do C√≥digo

O c√≥digo √© organizado em uma √∫nica classe principal (`App`) e algumas fun√ß√µes auxiliares.

### Fun√ß√µes Auxiliares

-   `resource_path(relative_path)`: Fun√ß√£o essencial para que o PyInstaller encontre arquivos (como o √≠cone `.ico`) quando o aplicativo √© compilado em um execut√°vel.
-   `validar_formato_chave(chave)`: Usa uma express√£o regular (regex) para verificar se uma string corresponde ao formato `XXXXX-XXXXX-XXXXX-XXXXX-XXXXX`. Retorna `True` ou `False`.
-   `extrair_chaves_da_imagem(caminho_imagem)`: O "motor" do OCR. Envia a imagem e um prompt espec√≠fico para a API Gemini e processa a resposta de texto para extrair as chaves.

### Classe Principal `App(ctk.CTk)`

Esta classe gerencia toda a interface gr√°fica e o estado do aplicativo.

#### `__init__(self)`
-   Configura a janela principal (t√≠tulo, tamanho, tema).
-   Define as fontes usadas na UI.
-   Inicializa as vari√°veis de estado: `self.resultados_atuais` (a lista de dados) e `self.widgets_linhas` (a lista de componentes da UI).
-   Constr√≥i todos os frames e widgets (bot√µes, caixas de texto, etc.) e os organiza na tela usando o sistema de `grid` e `pack`.

#### M√©todos de Extra√ß√£o
-   `iniciar_extracao_base(...)`: Uma fun√ß√£o gen√©rica que prepara a UI para o processamento (mostra a barra de progresso, bloqueia bot√µes) e inicia a extra√ß√£o em uma `thread` separada para n√£o travar a interface.
-   `_processar_arquivo_em_background(...)` e `_processar_pasta_em_background(...)`: Fun√ß√µes que rodam na `thread`. Elas chamam a fun√ß√£o de OCR e, ao final, agendam a atualiza√ß√£o da interface na thread principal usando `self.after(...)`.

#### M√©todos de Atualiza√ß√£o da UI
-   `_sincronizar_painel_com_dados()`: **M√©todo crucial.** L√™ os valores atuais de todos os campos de texto da interface e salva essas informa√ß√µes na lista de dados `self.resultados_atuais`.
-   `_redesenhar_painel_completo()`: Destr√≥i todos os widgets de linha existentes e os recria do zero com base na lista de dados atual. √â chamado sempre que a lista √© modificada (adicionada, exclu√≠da, reordenada).
-   `_atualizar_relatorio_validacao()`: Atualiza o painel de relat√≥rio na parte inferior, listando todas as chaves com formato inv√°lido e o n√∫mero da linha correspondente.
-   `_desenhar_linha_chave(...)`: Cria todos os widgets para uma √∫nica linha de chave (n√∫mero, nome da imagem, campo de texto, status de valida√ß√£o e bot√µes de a√ß√£o).
    -   **Valida√ß√£o Din√¢mica:** A m√°gica acontece aqui, onde a `StringVar` do campo de texto tem um "trace". Qualquer altera√ß√£o no texto dispara a fun√ß√£o `on_key_change`, que atualiza o status da linha e o painel de relat√≥rio em tempo real.

#### M√©todos de A√ß√£o do Usu√°rio
-   `handle_adicionar_manual()`: Sincroniza, adiciona uma nova linha em branco aos dados e redesenha o painel.
-   `mover_linha(...)`: Sincroniza, troca a posi√ß√£o de dois itens na lista de dados e redesenha o painel.
-   `excluir_linha_chave(...)`: Sincroniza, remove um item da lista de dados e redesenha o painel.
-   `limpar_tudo()`: Limpa a lista de dados e redesenha o painel.

#### M√©todos de Salvamento
-   `_coletar_dados_do_painel()`: Sincroniza os dados uma √∫ltima vez e realiza a valida√ß√£o final. Se encontrar uma chave inv√°lida, exibe um erro e impede o salvamento. Se tudo estiver correto, retorna um DataFrame do Pandas.
-   `substituir_em_excel()` e `adicionar_ao_excel()`: Coletam os dados validados e usam o Pandas para salv√°-los no arquivo `.xlsx`, com a op√ß√£o `header=False` para omitir a linha de cabe√ßalho.
